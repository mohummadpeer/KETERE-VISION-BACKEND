version: "3.8"

services:
  api:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        NODE_ENV: production
    image: ketere-backend:latest
    restart: always
    environment:
      - NODE_ENV=production
      - PORT=4000
      - DATABASE_URL=${DATABASE_URL}   # fournie via .env
    ports:
      - "4000:4000"
    env_file:
      - .env.production
    healthcheck:
      test: ["CMD-SHELL", "node dist/index.js >/dev/null 2>&1 || exit 1"]
      interval: 30s
      timeout: 3s
      retries: 3
